var CryptoJS=CryptoJS||function(l,q){var e={},h=e.lib={},f=function(){},a=h.Base={extend:function(b){f.prototype=this;var g=new f;b&&g.mixIn(b);g.hasOwnProperty("init")||(g.init=function(){g.$super.init.apply(this,arguments)});g.init.prototype=g;g.$super=this;return g},create:function(){var b=this.extend();b.init.apply(b,arguments);return b},init:function(){},mixIn:function(b){for(var g in b)b.hasOwnProperty(g)&&(this[g]=b[g]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},
c=h.WordArray=a.extend({init:function(b,g){b=this.words=b||[];this.sigBytes=g!=q?g:4*b.length},toString:function(b){return(b||m).stringify(this)},concat:function(b){var g=this.words,c=b.words,a=this.sigBytes;b=b.sigBytes;this.clamp();if(a%4)for(var k=0;k<b;k++)g[a+k>>>2]|=(c[k>>>2]>>>24-k%4*8&255)<<24-(a+k)%4*8;else if(65535<c.length)for(k=0;k<b;k+=4)g[a+k>>>2]=c[k>>>2];else g.push.apply(g,c);this.sigBytes+=b;return this},clamp:function(){var b=this.words,g=this.sigBytes;b[g>>>2]&=4294967295<<32-
g%4*8;b.length=l.ceil(g/4)},clone:function(){var b=a.clone.call(this);b.words=this.words.slice(0);return b},random:function(b){for(var g=[],a=0;a<b;a+=4)g.push(4294967296*l.random()|0);return new c.init(g,b)}}),d=e.enc={},m=d.Hex={stringify:function(b){var g=b.words;b=b.sigBytes;for(var a=[],c=0;c<b;c++){var k=g[c>>>2]>>>24-c%4*8&255;a.push((k>>>4).toString(16));a.push((k&15).toString(16))}return a.join("")},parse:function(b){for(var g=b.length,a=[],d=0;d<g;d+=2)a[d>>>3]|=parseInt(b.substr(d,2),16)<<
24-d%8*4;return new c.init(a,g/2)}},n=d.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var c=[],d=0;d<b;d++)c.push(String.fromCharCode(a[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(b){for(var a=b.length,d=[],n=0;n<a;n++)d[n>>>2]|=(b.charCodeAt(n)&255)<<24-n%4*8;return new c.init(d,a)}},I=d.Utf8={stringify:function(b){try{return decodeURIComponent(escape(n.stringify(b)))}catch(a){throw Error("Malformed UTF-8 data");}},parse:function(b){return n.parse(unescape(encodeURIComponent(b)))}},
y=h.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init;this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=I.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,d=a.words,n=a.sigBytes,k=this.blockSize,f=n/(4*k),f=b?l.ceil(f):l.max((f|0)-this._minBufferSize,0);b=f*k;n=l.min(4*b,n);if(b){for(var m=0;m<b;m+=k)this._doProcessBlock(d,m);m=d.splice(0,b);a.sigBytes-=n}return new c.init(m,n)},clone:function(){var b=a.clone.call(this);
b._data=this._data.clone();return b},_minBufferSize:0});h.Hasher=y.extend({cfg:a.extend(),init:function(b){this.cfg=this.cfg.extend(b);this.reset()},reset:function(){y.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);return this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,c){return(new b.init(c)).finalize(a)}},_createHmacHelper:function(b){return function(a,c){return(new v.HMAC.init(b,
c)).finalize(a)}}});var v=e.algo={};return e}(Math);
(function(){var l=CryptoJS,q=l.lib,e=q.WordArray,h=q.Hasher,f=[],q=l.algo.SHA1=h.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,c){for(var d=this._hash.words,m=d[0],n=d[1],h=d[2],e=d[3],v=d[4],b=0;80>b;b++){if(16>b)f[b]=a[c+b]|0;else{var g=f[b-3]^f[b-8]^f[b-14]^f[b-16];f[b]=g<<1|g>>>31}g=(m<<5|m>>>27)+v+f[b];g=20>b?g+((n&h|~n&e)+1518500249):40>b?g+((n^h^e)+1859775393):60>b?g+((n&h|n&e|h&e)-1894007588):g+((n^h^
e)-899497514);v=e;e=h;h=n<<30|n>>>2;n=m;m=g}d[0]=d[0]+m|0;d[1]=d[1]+n|0;d[2]=d[2]+h|0;d[3]=d[3]+e|0;d[4]=d[4]+v|0},_doFinalize:function(){var a=this._data,c=a.words,d=8*this._nDataBytes,h=8*a.sigBytes;c[h>>>5]|=128<<24-h%32;c[(h+64>>>9<<4)+14]=Math.floor(d/4294967296);c[(h+64>>>9<<4)+15]=d;a.sigBytes=4*c.length;this._process();return this._hash},clone:function(){var a=h.clone.call(this);a._hash=this._hash.clone();return a}});l.SHA1=h._createHelper(q);l.HmacSHA1=h._createHmacHelper(q)})();
(function(){var l=CryptoJS,q=l.enc.Utf8;l.algo.HMAC=l.lib.Base.extend({init:function(e,h){e=this._hasher=new e.init;"string"==typeof h&&(h=q.parse(h));var f=e.blockSize,a=4*f;h.sigBytes>a&&(h=e.finalize(h));h.clamp();for(var c=this._oKey=h.clone(),d=this._iKey=h.clone(),m=c.words,n=d.words,l=0;l<f;l++)m[l]^=1549556828,n[l]^=909522486;c.sigBytes=d.sigBytes=a;this.reset()},reset:function(){var e=this._hasher;e.reset();e.update(this._iKey)},update:function(e){this._hasher.update(e);return this},finalize:function(e){var h=
this._hasher;e=h.finalize(e);h.reset();return h.finalize(this._oKey.clone().concat(e))}})})();
(function(){var l=CryptoJS,q=l.lib.WordArray;l.enc.Base64={stringify:function(e){var h=e.words,f=e.sigBytes,a=this._map;e.clamp();e=[];for(var c=0;c<f;c+=3)for(var d=(h[c>>>2]>>>24-c%4*8&255)<<16|(h[c+1>>>2]>>>24-(c+1)%4*8&255)<<8|h[c+2>>>2]>>>24-(c+2)%4*8&255,m=0;4>m&&c+0.75*m<f;m++)e.push(a.charAt(d>>>6*(3-m)&63));if(h=a.charAt(64))for(;e.length%4;)e.push(h);return e.join("")},parse:function(e){var h=e.length,f=this._map,a=f.charAt(64);a&&(a=e.indexOf(a),-1!=a&&(h=a));for(var a=[],c=0,d=0;d<h;d++)if(d%
4){var m=f.indexOf(e.charAt(d-1))<<d%4*2,n=f.indexOf(e.charAt(d))>>>6-d%4*2;a[c>>>2]|=(m|n)<<24-c%4*8;c++}return q.create(a,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();this.JSON||(this.JSON={});
(function(){function l(a){return 10>a?"0"+a:a}function q(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var c=d[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(d,h){var f,l,b,g,s=a,r,k=h[d];k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(d));"function"===typeof m&&(k=m.call(h,d,k));switch(typeof k){case "string":return q(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);
case "object":if(!k)return"null";a+=c;r=[];if("[object Array]"===Object.prototype.toString.apply(k)){g=k.length;for(f=0;f<g;f+=1)r[f]=e(f,k)||"null";b=0===r.length?"[]":a?"[\n"+a+r.join(",\n"+a)+"\n"+s+"]":"["+r.join(",")+"]";a=s;return b}if(m&&"object"===typeof m)for(g=m.length,f=0;f<g;f+=1)l=m[f],"string"===typeof l&&(b=e(l,k))&&r.push(q(l)+(a?": ":":")+b);else for(l in k)Object.hasOwnProperty.call(k,l)&&(b=e(l,k))&&r.push(q(l)+(a?": ":":")+b);b=0===r.length?"{}":a?"{\n"+a+r.join(",\n"+a)+"\n"+
s+"}":"{"+r.join(",")+"}";a=s;return b}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+l(this.getUTCMonth()+1)+"-"+l(this.getUTCDate())+"T"+l(this.getUTCHours())+":"+l(this.getUTCMinutes())+":"+l(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,c,d={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;"function"!==typeof JSON.stringify&&(JSON.stringify=function(d,h,f){var l;c=a="";if("number"===typeof f)for(l=0;l<f;l+=1)c+=" ";else"string"===typeof f&&(c=f);if((m=h)&&"function"!==typeof h&&("object"!==typeof h||"number"!==typeof h.length))throw Error("JSON.stringify");return e("",{"":d})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,c){function d(b,a){var f,h,k=b[a];if(k&&"object"===typeof k)for(f in k)Object.hasOwnProperty.call(k,f)&&(h=d(k,f),void 0!==h?k[f]=h:delete k[f]);return c.call(b,a,k)}var f;a=String(a);h.lastIndex=0;h.test(a)&&(a=a.replace(h,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),"function"===typeof c?d({"":f},""):f;throw new SyntaxError("JSON.parse");})})();
var Scoreflex=function(l,q,e){var h;h={inArray:function(f,a){for(var c=0;c<a.length;c++)if(a[c]===f)return!0;return!1},rawurlencode:function(f){f=(f+"").toString();return encodeURIComponent(f).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},getUUID:function(){var f=Array(31);if(window.crypto&&crypto.getRandomValues){var a=new Uint8Array(31);crypto.getRandomValues(a);for(var c=0;31>c;c++)f[c]=a[c]&15}else for(c=0;31>c;c++)f[c]=16*Math.random()|
0;var d=0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=f[d++];return("x"==a?c:c&3|8).toString(16)})},getDeviceId:function(){var f;window.localStorage&&(f=localStorage.getItem("deviceId"));f||(f=this.getUUID()+"-"+(+new Date).toString(16),window.localStorage&&localStorage.setItem("deviceId",f));return f},fireEvent:function(f,a,c){var d;if(document.createEventObject)return d=document.createEventObject(),d.data=c,f.fireEvent("on"+a,d);d=document.createEvent("HTMLEvents");
d.initEvent(a,!0,!0);d.data=c;return!f.dispatchEvent(d)}};return function(f,a,c){var d="af ar be bg bn ca cs da de el en en_GB en_US es es_ES es_MX et fa fi fr fr_FR fr_CA he hi hr hu id is it ja ko lt lv mk ms nb nl pa pl pt pt_PT pt_BR ro ru sk sl sq sr sv sw ta th tl tr uk vi zh zh_CN zh_TW zh_HK".split(" "),e=!1,l=null,q=null,y=!0,v=function(){var b=function(b,a){var c=new XMLHttpRequest;"withCredentials"in c?c.open(b,a,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(b,a)):
c=null;return c},a=function(b,a){return b.k==a.k?b.v<a.v?-1:1:b.k<a.k?-1:1};return{request:function(a,c,d,f,h,e){var u=b(a,c);if(void 0!==h)for(var w in h)u.setRequestHeader(w,h[w]);if(u){if(e)for(w=["onerror","ontimeout","onabort","onloadend"],c=0;c<w.length;c++)e[w[c]]&&(u[w[c]]=e[w[c]]);u.onload=function(){if(e){try{var a;a:{try{a=JSON.parse(this.responseText);break a}catch(b){}a=null}u.responseJSON=a}catch(c){}200==this.status&&e.onload?e.onload.apply(this,arguments):e.onerror&&e.onerror.apply(this,
arguments)}};"POST"===a?u.send(d):u.send()}},getSignature:function(b,c,d,f){void 0===f&&(f="");void 0===d&&(d=[]);var p,e=document.createElement("a");e.href=c;c=e.protocol.substr(0,e.protocol.length-1).toLowerCase();var g=e.hostname.toLowerCase(),w=e.pathname,e=e.search;0<e.length&&"?"===e[0]&&(e=e.substr(1));var e=e.split("&"),k=[],l;for(p=0;p<e.length;p++)""!==e[p]&&(l=e[p].split("=",2),k.push({k:l[0],v:l[1]}));var e=h.rawurlencode,m;for(m in d)k.push({k:e(m),v:e(d[m])});k.sort(a);d=[];for(p=0;p<
k.length;p++)d.push(k[p].k+"="+k[p].v);d=d.join("&");b=b+"&"+e(c+"://"+g+w)+"&"+e(d)+"&"+e(f);b=CryptoJS.HmacSHA1(b,q).toString(CryptoJS.enc.Base64);return'Scoreflex sig="'+e(b)+'", meth="0"'}}}(),b={ScoreflexSessionEvent:function(b,a){return{name:"session",login:b,logout:a}},ScoreflexPlayEvent:function(b){return{name:"play",leaderboard:D}},ScoreflexChallengeEvent:function(b){return{name:"challenge",challenge:b}},fire:function(b){h.fireEvent(window,"ScoreflexEvent",b)}},g=function(){var b=function(b){return(y?
"https://sandbox.api.scoreflex.com":"https://api.scoreflex.com")+"/v1"+b},a=function(b){void 0===b&&(b={});var a=z()||{},c=a.lang||window.navigator.language;b.lang=h.inArray(c,d)?c:"en";a.accessToken&&(b.accessToken=a.accessToken);return b},c=function(b){var a=[],c;for(c in b)a.push(encodeURIComponent(c)+"="+encodeURIComponent(b[c]));return a.join("&")};return{post:function(e,d,f,h){d=a(d);e=b(e);var k=c(d);d={"Content-type":"application/x-www-form-urlencoded","X-Scoreflex-Authorization":v.getSignature("POST",
e,d,f)};v.request("POST",e,k,f,d,h)},get:function(e,d,f){d=a(d);e=b(e);(d=c(d))&&(e=e+"?"+d);v.request("GET",e,{},void 0,{},f)}}}(),s=function(){var a={},c={},f=[],k=function(b){if(!a[b]){var e=document.createElement("iframe");e.id="scoreflexWebClient_"+b;a[b]=e;e.onload=function(){c[b]=e.contentWindow}}return a[b]},g=function(b){for(var a=0;a<f.length;a++)if(f[a]===b){f.splice(a,1);break}},q=null;window.addEventListener("message",function(a){if("https://api.scoreflex.com"==a.origin||"https://sandbox.api.scoreflex.com"==
a.origin){var d=a.data;if(d!==q){q=d;var f=document.createElement("a");f.href=d;if("/v1/web/callback"==f.pathname){d=f.search;0<d.length&&"?"==d[0]&&(d=d.substr(1));var f=d.split("&"),d={},p,k,g;for(k=0;k<f.length;k++)f[k]&&(p=f[k].split("=",2),d[p[0]]=p[1]);f=null;for(g in c)if(a.source===c[g]){f=g;break}a=f;f=d.code;g=d.data?JSON.parse(decodeURIComponent(d.data)):{};switch(f){case "200000":t(a);A(null,!0);E();b.fire(Event.ScoreflexSessionEvent(!1,!0));break;case "200001":t(a);break;case "200002":b.fire(Event.ScoreflexLeaderboardEvent(F.get(g.leaderboardId)));
t(a);break;case "200003":t(a);e&&(a=z(),!0===a.anonymous&&(g={clientId:l,devicePlatform:"Web",deviceModel:window.navigator.userAgent||"browser",deviceId:h.getDeviceId(),state:G(!0)},a.accessToken&&(g.anonymousAccessToken=a.accessToken,g.forceMerge="true"),g=x(g,void 0),s.show("/oauth/web/authorize",g,void 0,{style:"full",noSid:!0})));break;case "200004":d=g.code;g=g.state;t(a);J({code:d,state:g});break;case "200005":d=g.url;g=g.mode;t(a);r(d,{},{style:g});break;case "200006":t(a);break;case "200007":d=
g.challengeInstanceId;g=g.challengeConfigId;t(a);b.fire(Event.ScoreflexChallengeEvent(H.get(d,g)));break;case "200008":t(a);break;case "200009":t(a);break;case "200010":t(a)}}}}},!1);var r=function(a,b,c,e){c=c||{};if(void 0!==e)for(var p in e)void 0===c[p]&&(c[p]=e[p]);e=b;if(-1!==a.indexOf("://"))b=a;else if(b=y,z().sid){p=c;void 0===e&&(e={});void 0===p&&(p={});var u=z()||{},l=u.lang||window.navigator.language;e.lang=h.inArray(l,d)?l:"en";u.sid&&!p.noSid&&(e.sid=u.sid);p=[];for(var m in e)p.push(encodeURIComponent(m)+
"="+encodeURIComponent(e[m]));m=p.join("&");b=(b?"https://sandbox.api.scoreflex.com":"https://api.scoreflex.com")+"/v1"+a+"?"+m}else b=null;b?(a=c.id||c.style||"full",m=k(a),m.src=b+"#start",c="scoreflexWebClient_"+c.style,void 0!==c&&(b=m.getAttribute("data-stylename"),b!==c&&(m.classList.remove(b),m.classList.add(c),m.setAttribute("data-stylename",c))),document.body.appendChild(m),g(a),f.push(a)):t()},t=function(a){var b;a||(a=0<f.length?f[f.length-1]:null);a&&(b=k(a))&&b.parentNode&&(b.parentNode.removeChild(b),
g(a))};return{show:r,close:t}}(),r=function(){_ns="SFX_";return{get:function(a){return(a=localStorage.getItem(_ns+a))?JSON.parse(a):null},set:function(a,b){var c=JSON.stringify(b);return localStorage.setItem(_ns+a,c)},rm:function(a){return localStorage.removeItem(_ns+a)}}}(),k=function(a,b){var c=function(){return b||{}};return{getId:function(){return a},getData:c,getNickname:function(){return c().nickName||""},showProfile:function(b,c){B.showProfile(a,b,c)},showFriends:function(b,c){showPlayerFriends(a,
b,c)}}},B=function(){var a={};return{get:function(b,c,d,f){if(e)if(void 0===d&&(d={}),!f&&a[b]){if(d.onload){var h=k(b,a[b]);setTimeout(function(){d.onload.call(null,h)},0)}}else{var l=d.onload;d.onload=function(){var c=this.responseJSON||{};a[b]=c;c=k(b,c);l.call(this,c)};g.get("/players/"+b,c,d)}},getCurrent:function(){var a=(z()||{}).me||{};return k(a.id,a)},showProfile:function(a,b,c){e&&(void 0===a&&(a="me"),b=x({},b),s.show("/web/players/"+a,b,c,{style:"full"}))},showFriends:function(a,b,c){e&&
(void 0===a&&(a="me"),b=x({},b),s.show("/web/players/"+a+"/friends",b,c,{style:"full"}))}}}(),D=function(a){var b=function(b,c,d){e&&(b={score:b},b=x(b,c),g.post("/scores/"+a,b,void 0,d))},c=function(b,c){if(e){var d=x({},b);s.show("/web/scores/"+a+"/ranks",d,c,{style:"panel"})}};return{getId:function(){return a},submitScore:b,show:function(b,c){if(e){var d=x({},b);s.show("/web/leaderboards/"+a,d,c,{style:"full"})}},showOverview:function(b,c){if(e){var d=x({},b);s.show("/web/leaderboards/"+a+"/overview",
d,c,{style:"full"})}},showRankbox:c,submitScoreAndShowRankbox:function(a,d,e){b(a,d);d=d||{};d.score=a;c(d,e)}}},F=function(){return{get:function(a){return D(a)}}}(),H=function(){return{showChallenges:function(a,b){if(e){var c=x({},a);s.show("/web/challenges",c,b,{style:"full"})}},get:function(a,b){return Challenge(a,b)}}}(),z=function(){var a=r.get("sessions");a||(a={});return a.player?a.player:a.anonymous},A=function(a,b){var c=r.get("sessions");c||(c={});!0===b?c.player=a:c.anonymous=a;r.set("sessions",
c)},C=null,G=function(a){if(!0===a||null===C)C="S"+ +new Date;return C},x=function(a,b){void 0===a&&(a={});if(void 0!==b)for(var c in b)a[c]=b[c];return a},K=function(a){var b={clientId:l,devicePlatform:"Web",deviceModel:window.navigator.userAgent||"browser",deviceId:h.getDeviceId()};g.post("/oauth/anonymousAccessToken",b,void 0,a)},E=function(){var a=z(),b={onload:function(){var a=this.responseJSON||{},b=(a.accessToken||{}).token||null,c=a.sid||null,a=a.me||{},d=a.id||null,f=a.language||null;b&&
c&&d&&A({anonymous:!0,accessToken:b,sid:c,playerId:d,lang:f,me:a},!1);e=!0},onerror:function(){}};a&&a.accessToken&&a.sid&&a.playerId?b.onload&&setTimeout(b.onload,0):K(b)},J=function(a){a.state===G()&&(a={code:a.code,clientId:l},handlers={onload:function(){var a=this.responseJSON||{},c=(a.accessToken||{}).token||null,d=a.sid||null,a=a.me||{},e=a.id||null,f=a.language||null;c&&d&&e&&(A({anonymous:!1,accessToken:c,sid:d,playerId:e,lang:f,me:a},!0),A(null,!1));B.showProfile();b.fire(Event.ScoreflexSessionEvent(!0,
!1))},onerror:function(){}},g.post("/oauth/accessToken",a,void 0,handlers))};(function(a,b,c){e||(l=a,q=b,y=c,E())})(f,a,c);return{reset:function(){r.rm("sessions")},RestClient:g,ping:function(a){g.get("/network/ping",{},a)},WebClient:s,Leaderboards:F,Players:B,Challenges:H}}(l,q,e)};
